"""Cannon, hitting targets with projectiles.

Exercises

1. Keep score by counting target hits.
2. Vary the effect of gravity.
3. Apply gravity to the targets.
4. Change the speed of the ball.
"""

from random import randrange
from turtle import *

from freegames import vector

ball = vector(-200, -200)
speed = vector(0, 0)
targets = []

def tap(x, y):
    """Respond to screen tap."""
    if not inside(ball):
        ball.x = -199
        ball.y = -199
        speed.x = (x + 200) / 25
        speed.y = (y + 200) / 25

def inside(xy):
    """Return True if xy within screen."""
    return -200 < xy.x < 200 and -200 < xy.y < 200

def draw():
    """Draw ball and targets."""
    clear()

    for target in targets:
        goto(target.x, target.y)
        dot(20, 'blue')

    if inside(ball):
        goto(ball.x, ball.y)
        dot(6, 'red')

    update()

def move():
    """Move ball and targets."""
    # Generar nuevos objetivos aleatoriamente
    if randrange(40) == 0:
        y = randrange(-150, 150)
        target = vector(200, y)
        targets.append(target)

    # Mover los objetivos de manera más inteligente
    for target in targets:
        # Si la bola está cerca, moverse hacia arriba o hacia abajo para evitar ser golpeado
        if abs(target.x - ball.x) < 50 and abs(target.y - ball.y) < 50:
            if target.y < ball.y:
                target.y -= 0.5  # Moverse hacia abajo
            else:
                target.y += 0.5  # Moverse hacia arriba
        else:
            target.x -= 0.5  # Movimiento normal hacia la izquierda

    # Mover la bola con gravedad
    if inside(ball):
        speed.y -= 0.35
        ball.move(speed)

    # Eliminar objetivos golpeados
    dupe = targets.copy()
    targets.clear()

    for target in dupe:
        if abs(target - ball) > 13:
            targets.append(target)

    draw()

    # Verificar si algún objetivo ha salido de la pantalla
    for target in targets:
        if not inside(target):
            return

    ontimer(move, 50)

setup(420, 420, 370, 0)
hideturtle()
up()
tracer(False)
onscreenclick(tap)
move()
done()
